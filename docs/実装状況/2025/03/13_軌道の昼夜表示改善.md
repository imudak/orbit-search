# 軌道の昼夜表示改善

## 実装内容

1. **太陽の位置表示機能の追加**
   - 太陽の位置をアイコンで表示するSunPositionLayerを実装
   - DivIconを使用して太陽アイコンを作成
   - アニメーションに合わせて太陽の位置が更新される

2. **昼間の領域表示機能の改善**
   - 太陽の軌道を表示する代わりに、昼間の領域を透明な黄色の帯として表示
   - 日付変更線をまたぐ場合の処理を追加
     - 昼間の領域が日付変更線をまたぐ場合、2つのポリゴンに分割
     - 日付変更線をまたがない場合は1つのポリゴンで表示

3. **衛星軌道の昼夜判定と太陽位置の同期**
   - 共通のユーティリティ関数を作成して太陽位置計算を一元化
   - 衛星軌道の昼夜判定と太陽の昼夜表示が一致するように修正
   - アニメーション時の時刻更新方法を改善

4. **時間制御パネルの改善**
   - タイムゾーン情報（GMT+9）を追加
   - UTC時刻の表示を追加

## 技術的な詳細

### 太陽位置計算

太陽の位置計算には以下の数式を使用：

```typescript
// 太陽の赤緯を計算
const L = 280.460 + 0.9856474 * dayOfYear;
const g = 357.528 + 0.9856003 * dayOfYear;
const lambda = L + 1.915 * Math.sin(g * DEG_TO_RAD) + 0.020 * Math.sin(2 * g * DEG_TO_RAD);
const epsilon = 23.439 - 0.0000004 * dayOfYear;
const declination = Math.asin(Math.sin(epsilon * DEG_TO_RAD) * Math.sin(lambda * DEG_TO_RAD)) * RAD_TO_DEG;
```

### 昼夜の境界判定

太陽高度に基づいて昼夜を判定：

```typescript
// 大気による屈折を考慮した太陽高度による昼夜判定
// -0.833は大気による屈折と太陽の視半径を考慮した値
return altitude > -0.833;
```

### 日付変更線をまたぐ場合の処理

昼間の領域が日付変更線をまたぐかどうかを判定：

```typescript
// 日付変更線をまたぐかどうかを判定
const crossesDateLine = Math.abs(eastBoundary - westBoundary) > 180 ||
                       eastBoundary > 180 || eastBoundary < -180 ||
                       westBoundary > 180 || westBoundary < -180;
```

## 今後の課題

1. 太陽の位置計算の精度向上
   - より高精度な天文アルゴリズムの導入
   - 地球の楕円軌道の影響を考慮

2. パフォーマンスの最適化
   - ポリゴン描画の最適化
   - 不要な再計算の削減

3. UI/UXの改善
   - 太陽アイコンのデザイン改善
   - 昼夜の境界線の視認性向上
