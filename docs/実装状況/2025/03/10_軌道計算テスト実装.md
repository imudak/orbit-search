# 軌道計算テスト実装

## 概要

衛星軌道表示の問題を解決するため、軌道計算ロジックと地図表示の問題を切り分けるためのテストツールを実装しました。

## 背景

`docs/satellite-orbit-investigation.md` で報告されている通り、衛星軌道が地図上で正しく表示されない問題が発生しています。この問題の根本原因を特定するために、軌道計算そのものが正しいのか、それとも地図への表示方法に問題があるのかを切り分ける必要があります。

## 実装内容

### 1. 軌道計算テスト用HTMLファイルの作成

satellite.jsライブラリを直接使用して軌道計算を行い、結果を表示するためのHTMLファイル `orbit-test.html` を作成しました。このファイルには以下の機能があります：

- TLEデータの入力
- 観測地点の緯度・経度の設定
- 計算期間と時間間隔の設定
- 計算結果の表形式での表示（時刻、衛星緯度、衛星経度、仰角、方位角、距離）
- 仰角に基づく行の色分け表示

### 2. テストの目的

このテストツールを使用することで、以下のことが可能になります：

1. 軌道計算そのものの正確性を確認
2. 相対座標と絶対座標の両方を表示して比較
3. 仰角と実際の地理座標の関係を視覚的に確認
4. 日付変更線をまたぐ場合の挙動を確認

## テスト結果と検証

### 1. テストツールによる軌道計算の検証

テストツール（orbit-test.html）を使用して以下の検証を行いました：

- ISSのTLEデータを使用して軌道計算を実行し、正しく計算されることを確認
- 計算結果から、経度の正規化や日付変更線をまたぐ場合の処理が適切に行われていることを確認
- 仰角と地理座標の関係が正しく計算されていることを確認

### 2. アプリケーションでの検証

アプリケーションを実行して問題の衛星（NORAD ID: 05118）の軌道表示を確認しました：

- 衛星リストに問題の衛星（NORAD ID: 05118）が正しく表示されていることを確認
- コンソールログから軌道計算が正しく行われていることを確認
- 地図上での軌道表示が観測地点と正しく関連付けられていることを確認

### 3. 修正内容の有効性

以下の修正が正しく機能していることを確認しました：

- `orbitWorker.ts`での修正：相対経度ではなく実際の経度を使用するように変更
- 経度の正規化方法の改善：複数回の正規化が必要な場合に対応
- `SatelliteOrbitLayer.tsx`の簡素化：複雑な座標変換を削除し、絶対座標を使用

これらの修正により、衛星軌道が観測地点と正しく関連付けられて表示されるようになりました。テストツールと実際のアプリケーションの両方で検証し、問題が解決されたことを確認しました。

## 技術的詳細

テストツールは以下の技術を使用しています：

- satellite.js: 衛星軌道計算ライブラリ
- 純粋なHTML/JavaScript: フレームワークに依存せず、単独で動作
- 標準的なDOM操作: 結果の表示と操作

## コミット情報

```
[feature/fix-orbit-calculaion 24e6f10] 軌道計算テスト用のHTMLファイルを追加
 1 file changed, 271 insertions(+)
 create mode 100644 orbit-test.html

[feature/fix-orbit-calculaion 8a7f52c] 軌道計算テスト結果と検証を追加
 1 file changed, 42 insertions(+), 7 deletions(-)
 modify docs/実装状況/2025/03/10_軌道計算テスト実装.md
