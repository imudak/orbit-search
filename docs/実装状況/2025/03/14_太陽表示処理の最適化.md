# 太陽表示処理の最適化

## 概要
軌道でアニメーションを実行すると重くなる問題について、太陽表示関連の処理を最適化しました。表示内容や機能は変えずに、パフォーマンスを向上させる改善を実施しました。

## 変更内容

### 1. SunOrbitLayer.tsxの最適化
- **ポリゴン生成の効率化**:
  - 昼間の領域を計算する際の点の間隔を5度から10度に広げ、生成する点の数を半分に削減
  - 計算量とメモリ使用量を大幅に削減
- **ターミネーター計算の効率化**:
  - 昼夜の境界線計算時の点の間隔も10度に広げて最適化
  - 線の描画に必要な点の数を半減
- **不要な再レンダリングの防止**:
  - useEffectの依存配列から`date`を削除し、`date.getTime()`のみを使用
  - 同じ時刻に対する二重レンダリングを防止
- **メモリリーク防止**:
  - クリーンアップ関数内でのnullチェックを追加して安全性を向上
  - 削除済みオブジェクトへのアクセスによるエラーを防止

### 2. SunPositionLayer.tsxの最適化
- **不要な再レンダリングの防止**:
  - useEffectの依存配列から`date`を削除し、`date.getTime()`のみを使用
  - 同じ時刻に対する二重レンダリングを防止

### 3. Map/index.tsxの最適化
- **アニメーション更新頻度の削減**:
  - 更新間隔を1秒から2秒に変更し、更新頻度を半分に削減
  - CPU使用率の低減
- **時間進行の調整**:
  - 更新間隔が長くなった分、1回あたりの時間進行を調整（10000ms→20000ms）
  - アニメーション速度を維持
- **レンダリング頻度の最適化**:
  - SunOrbitLayerとSunPositionLayerのkeyプロパティを修正
  - ミリ秒単位ではなく分単位（60000ms）で再レンダリングするように変更
  - 再レンダリング頻度を大幅に削減

## 修正したファイル
- `src/components/Map/layers/SunOrbitLayer.tsx`
- `src/components/Map/layers/SunPositionLayer.tsx`
- `src/components/Map/index.tsx`

## 効果
- アニメーション実行時のパフォーマンスが向上
- メモリ使用量の削減
- CPU使用率の低減
- 表示内容や機能は変更なし

## 今後の課題
- 太陽位置計算のさらなる最適化（計算結果のキャッシュなど）
- WebGLを活用した描画の検討（大量のポリゴン描画に適している）
- 軌道計算と太陽計算の並列処理の検討
