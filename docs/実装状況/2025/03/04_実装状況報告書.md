# 実装状況報告書

## 日付: 2025/03/04

## 担当者: 開発チーム

## 1. 実装項目

### 完了した実装
- ✅ 軌道表示の改善：期間内の軌道を一本の連続した線として表示
- ✅ 経度180度付近での不連続点を適切に処理
- ✅ 実効的な角度に基づく軌道の視覚的表現の実装
- ✅ 観測地点からの大圏距離を考慮した実効的な角度の計算

### 現在の問題点
- ❌ 観測地点からの可視範囲の表示が未実装
- ❌ 東西方向の距離を考慮した軌道表示の最適化が必要

## 2. サービス別の実装状況

### 型定義（types/index.ts）
- `PassPoint`インターフェースに新しいプロパティを追加
  - `isNewSegment`: 経度の不連続点かどうかを示すフラグ
  - `effectiveAngle`: 観測地点からの実効的な角度
- 新しい型の追加
  - `OrbitSegment`: 軌道セグメントの型
  - `OrbitPath`: 軌道データの型（セグメントの配列を含む）

### 軌道計算（orbitWorker.ts）
- 期間内の軌道を一本の連続した線として計算するように変更
- 経度の不連続点を検出して`isNewSegment`フラグを設定
- 観測地点から衛星までの大圏距離を計算
- 大圏距離に基づく減衰係数を計算
- 仰角と距離の両方を考慮した実効的な角度を計算

### 軌道データ処理（App.tsx）
- 軌道データをセグメントに分割
- 不連続点でセグメントを分割
- 各セグメントに実効的な角度を設定

### 軌道表示（Map.tsx）
- セグメントベースの描画に対応
- 実効的な角度に基づいてスタイルを設定
- 角度に基づく色分け
  - 45度以上: 赤色（#FF0000）- 最も見やすい
  - 20-45度: オレンジ色（#FFA500）- 中程度
  - 10-20度: 青色（#0000FF）- やや見えにくい
  - 10度未満: グレー色（#808080）- ほとんど見えない

## 3. 次のステップ

### 優先度：高
1. 観測地点からの可視範囲の表示
   - 最低仰角に基づく可視範囲を地図上に表示
   - 地球の曲率を考慮した正確な計算

2. 軌道表示の最適化
   - 東西方向の距離をより正確に考慮
   - 地球の裏側にある軌道の表示を適切に調整

### 優先度：中
1. パフォーマンスの最適化
   - 軌道計算の効率化
   - 表示の最適化（ポイント数の削減）

2. UI/UXの改善
   - 軌道情報の詳細表示
   - 時間経過に伴う軌道の変化のアニメーション

## 4. 技術的な改善点
1. 地球の曲率を考慮した計算方法の改善
2. 経度の不連続点の処理方法の最適化
3. 大圏距離の計算アルゴリズムの効率化
4. 実効的な角度の計算方法の精度向上

## 5. 運用上の注意点
- 軌道計算は計算負荷が高いため、長期間の計算時にはパフォーマンスに注意
- 複数の衛星を同時に表示する場合、ブラウザの性能に依存
- 経度180度付近を通過する衛星の軌道表示には特に注意が必要
- 実効的な角度の計算は近似値であり、実際の可視性と完全に一致しない場合がある
