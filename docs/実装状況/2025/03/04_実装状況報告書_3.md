# 実装状況報告書

## 日付: 2025/03/04

## 担当者: 開発チーム

## 1. 実装項目

### 完了した実装
- ✅ 観測地点からの可視範囲を地図上に表示する機能を追加
- ✅ 衛星高度を考慮した可視範囲の計算方法を実装
- ✅ 最低仰角に基づく可視範囲の表示
- ✅ LEO、MEO、GEOの軌道種類ごとに色分けして可視範囲を表示
- ✅ 可視範囲の円のインタラクションを改善（クリックイベントを下のレイヤーに伝播）
- ✅ 可視範囲の円にマウスオーバーでツールチップを表示する機能を追加
- ✅ 地図コントロールボタンを追加（全体表示ボタンと元の縮尺に戻す機能）
- ✅ 地図コントロールボタンの位置を左側中央に変更

### 現在の問題点
- ❌ 実際の衛星軌道高度を取得して計算に使用する機能は未実装（現在は固定値を使用）
- ❌ 可視範囲の表示/非表示を切り替える機能が必要

## 2. サービス別の実装状況

### Map.tsx
- 観測地点からの可視範囲を表示する`VisibilityCircle`コンポーネントを追加
- 衛星高度と仰角から可視範囲の半径を計算する`calculateVisibleRadius`関数を実装
- 最低仰角に基づいて可視範囲を表示するように`Map`コンポーネントを修正
- 衛星軌道の種類（LEO、MEO、GEO）ごとに色分けして可視範囲を表示する機能を追加
- 可視範囲の円のインタラクションを改善
  - `bubblingMouseEvents: true`を設定してクリックイベントを下のレイヤーに伝播
  - `interactive: false`を設定せず、マウスオーバーイベントを有効化
- マウスオーバー時にツールチップを表示する機能を追加
  - 軌道種類、高度、仰角、地表での距離を表示
  - マウスアウト時にツールチップを自動的に閉じる
- 地図コントロールボタンを追加
  - `MapControls`コンポーネントを実装
  - 全体表示ボタン：観測地点を中心に大きめの範囲を表示
  - 元の縮尺に戻すボタン：現在の観測地点を中心に、デフォルトのズームレベルに戻す
  - ズームイン/ズームアウトボタン
  - `MapContainer`の外に配置してイベント伝播の問題を解決
  - 位置を左側中央に設定

### 軌道種類の定義
- LEO（低軌道）: 800km、赤色
- MEO（中軌道）: 20,000km、緑色
- GEO（静止軌道）: 35,786km、青色

### 計算方法
- 衛星高度を考慮した可視範囲の計算
- 仰角から中心角を計算
- 中心角から地表での距離を計算

## 3. 次のステップ

### 優先度：高
1. 実際の衛星軌道高度を取得して計算に使用する機能の実装
   - 衛星データから軌道高度を取得
   - 衛星種類ごとに適切な可視範囲を計算

2. 可視範囲の表示/非表示を切り替える機能の追加
   - 軌道種類ごとに表示/非表示を切り替えるUI
   - ユーザー設定の保存

### 優先度：中
1. 可視範囲の表示スタイルの改善
   - 透明度や線の太さの調整
   - 最低仰角に応じた表示の変更

2. パフォーマンスの最適化
   - 計算処理の効率化
   - 表示の最適化

## 4. 技術的な改善点
1. 衛星の軌道要素から高度を正確に計算する方法の実装
2. 地球の扁平率を考慮した計算方法の検討
3. 大気による屈折を考慮した可視範囲の計算
4. 複数の観測地点に対応した可視範囲の表示
5. 時間経過に伴う可視範囲の変化のアニメーション表示

## 5. 運用上の注意点
- 各軌道種類の高度は平均的な値を使用しているため、実際の衛星の高度とは異なる場合がある
- 地図の表示範囲によっては可視範囲の円が見えない場合があるため、適切なズームレベルの調整が必要
- GEO衛星の可視範囲は非常に広いため、地図上で確認するには大きくズームアウトする必要がある
- 可視範囲の計算は簡略化されたモデルを使用しているため、実際の可視性と完全に一致しない場合がある
- 可視範囲の円にマウスオーバーするとツールチップが表示され、詳細情報を確認できる
- 可視範囲の円をクリックしても観測地点が移動できるようになっている（クリックイベントが下のレイヤーに伝播）
- 地図コントロールボタンは地図の左側中央に配置されている
  - 全体表示ボタン：観測地点を中心に大きめの範囲を表示
  - 元の縮尺に戻すボタン：現在の観測地点を中心に、デフォルトのズームレベルに戻す
  - ズームイン/ズームアウトボタン：地図の拡大/縮小
