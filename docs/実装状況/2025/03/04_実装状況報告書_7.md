# 実装状況報告書

## 日付: 2025/03/04

## 担当者: 開発チーム

## 1. 実装項目

### 完了した実装
- ✅ 地図と検索パネルのレイアウト問題を解決
- ✅ 地図コンテナの高さを適切に調整（モバイル: 400px、デスクトップ: 550px）
- ✅ 検索パネル内の最低仰角スライダーと観測地点情報を横並びに配置
- ✅ 地図コンテナのオーバーフロー設定を調整し、凡例などが見切れないように改善
- ✅ コンテナ間の余白を適切に設定し、視認性を向上
- ✅ 凡例を拡張し、可視範囲と軌道の色分けの違いを明確に説明

### 現在の問題点
- ❌ 実際の衛星軌道高度を取得して計算に使用する機能は未実装（現在は固定値を使用）
- ❌ 可視範囲の表示/非表示を切り替える機能が必要

## 2. サービス別の実装状況

### App.tsx
- 地図と検索パネルを別々のStyledPaperに分離
- 地図コンテナの高さを増加（xs: 400px, md: 550px）
- オーバーフロー設定を`visible`に変更して、コンテンツが見切れないように
- 下部マージンを増加して、コンテナ間の余白を確保
- StyledPaperのスタイルを調整（boxSizing: 'border-box'）

### SearchPanel.tsx
- 最低仰角のスライダーと観測地点情報を横並びに配置
- 検索パネルのz-index指定を削除（不要になったため）
- スライダーのマーク表示を最適化（0°、45°、90°）

### Map.tsx
- 地図コンテナ内の要素が適切に表示されるよう調整
- 凡例の位置を下から10pxに調整し、見切れないように改善
- 凡例コンポーネント（VisibilityLegend）を拡張
  - タイトルを「地図の色分け説明」に変更
  - 可視範囲の凡例と軌道の色分け凡例を分けて表示
  - それぞれの色分けの目的を明記
  - 軌道の色分けについて、実効的な角度ごとの色と線の太さを視覚的に表示
  - 各色分けの説明を追加

## 3. 次のステップ

### 優先度：高
1. 実際の衛星軌道高度を取得して計算に使用する機能の実装
   - 衛星データから軌道高度を取得
   - 衛星種類ごとに適切な可視範囲を計算

2. 可視範囲の表示/非表示を切り替える機能の追加
   - 軌道種類ごとに表示/非表示を切り替えるUI
   - ユーザー設定の保存

### 優先度：中
1. 可視範囲の表示スタイルの改善
   - 透明度や線の太さの調整
   - 最低仰角に応じた表示の変更

2. 色分けの説明改善（一部実装済み）
   - ✅ 可視範囲と軌道の色分けの違いをUI上で明確に説明
   - ✅ 凡例の拡充と配置の最適化
   - 色分けの目的をさらに分かりやすく伝える
   - ユーザーガイドの追加

3. パフォーマンスの最適化
   - 計算処理の効率化
   - 表示の最適化

## 4. 技術的な改善点
1. 衛星の軌道要素から高度を正確に計算する方法の実装
2. 地球の扁平率を考慮した計算方法の検討
3. 大気による屈折を考慮した可視範囲の計算
4. 複数の観測地点に対応した可視範囲の表示
5. 時間経過に伴う可視範囲の変化のアニメーション表示
6. レスポンシブデザインのさらなる改善

## 5. 運用上の注意点
- 各軌道種類の高度は平均的な値を使用しているため、実際の衛星の高度とは異なる場合がある
- 地図の表示範囲によっては可視範囲の円が見えない場合があるため、適切なズームレベルの調整が必要
- GEO衛星の可視範囲は非常に広いため、地図上で確認するには大きくズームアウトする必要がある
  - GEO（高度: 35,786km）: 可視範囲半径 = 9,526km（最低仰角10度の場合）
  - MEO（高度: 20,000km）: 可視範囲半径 = 9,236km（最低仰角10度の場合）
  - LEO（高度: 800km）: 可視範囲半径 = 7,075km（最低仰角10度の場合）
- 最低仰角を変更すると可視範囲の半径が変化する
  - 仰角が高いほど可視範囲は狭くなる
  - 仰角90度の場合は観測地点の真上のみ（可視範囲の半径は0）
- 可視範囲の計算は簡略化されたモデルを使用しているため、実際の可視性と完全に一致しない場合がある
- 地図と検索パネルが別々のコンテナに分離されたため、レイアウトの重なりが解消された
- 検索パネル内の最低仰角スライダーと観測地点情報が横並びになり、より効率的なスペース利用が実現

### 色分けについての注意点
- 可視範囲の色分けと衛星軌道の色分けは異なる基準で行われている
  - **可視範囲の色分け**：軌道種類（高度）に基づく
    - LEO（低軌道）: 赤色
    - MEO（中軌道）: 緑色
    - GEO（静止軌道）: 青色
  - **衛星軌道の色分け**：実効的な角度（仰角と距離）に基づく
    - 45度以上：赤色（最も見やすい）
    - 20〜45度：オレンジ色（見やすい）
    - 10〜20度：青色（見にくい）
    - 10度未満：灰色（最も見にくい）
- 可視範囲の色は「どの高度の衛星がどの範囲で観測可能か」を示している
- 軌道の色は「衛星がどの程度見やすいか（実効的な角度）」を示している
- 同じLEO衛星（赤い可視範囲）でも、観測地点から遠い場所では実効的な角度が小さくなり、軌道は青や灰色で表示される場合がある
- 凡例が拡張され、これらの違いが地図上で明確に説明されるようになった

---

© 2025 Kazumi OKANO
